<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute both MIMS-unit and sensor orientations with custom settings — custom_mims_unit • MIMSunit</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute both MIMS-unit and sensor orientations with custom settings — custom_mims_unit" />
<meta property="og:description" content="custom_mims_unit computes the Monitor Independent Motion Summary unit
and estimates the sensor orientations for the input multi-channel
accelerometer signal with custom settings. The input signal can be from
devices of any sampling rate and dynamic range. Please refer to the
manuscript for detailed description of the algorithm. Please refer to
functions for the intermediate steps: extrapolate for
extrapolation, iir for filtering,
aggregate_for_mims and aggregate_for_orientation
for aggregation." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>
<script async="" defer="" src="https://buttons.github.io/buttons.js"></script>
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38342303-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-38342303-3');
</script>



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MIMSunit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Get Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/mims_unit_from_files.html">Compute MIMS-unit from files</a>
    </li>
    <li>
      <a href="../articles/mims_unit_from_imported_data.html">Compute MIMS-unit from imported data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/datasets.html">Datasets</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Algorithm Walkthrough
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/conceptual_diagram.html">Step-by-step illustration</a>
    </li>
    <li>
      <a href="../articles/truncation_threshold.html">Deciding truncation threshold</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Performances
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/cross_device_consistency.html">Cross device consistency</a>
    </li>
    <li>
      <a href="../articles/edge_cases.html">Performance under edge conditions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API References</a>
</li>
<li>
  <a href="../news/index.html">Changelogs</a>
</li>
<li>
  <a href="../articles/faq.html">FAQs</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mhealthgroup/mimsunit">
    <span class="fa fa-lg fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute both MIMS-unit and sensor orientations with custom settings</h1>
    <small class="dont-index">Source: <a href='https://github.com/mhealthgroup/MIMSunit/blob/master/R/mims_unit.R'><code>R/mims_unit.R</code></a></small>
    <div class="hidden name"><code>custom_mims_unit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>custom_mims_unit</code> computes the Monitor Independent Motion Summary unit
and estimates the sensor orientations for the input multi-channel
accelerometer signal with custom settings. The input signal can be from
devices of any sampling rate and dynamic range. Please refer to the
manuscript for detailed description of the algorithm. Please refer to
functions for the intermediate steps: <code><a href='extrapolate.html'>extrapolate</a></code> for
extrapolation, <code><a href='iir.html'>iir</a></code> for filtering,
<code><a href='aggregate_for_mims.html'>aggregate_for_mims</a></code> and <code><a href='aggregate_for_orientation.html'>aggregate_for_orientation</a></code>
for aggregation.</p>
    </div>

    <pre class="usage"><span class='fu'>custom_mims_unit</span><span class='op'>(</span>
  <span class='va'>df</span>,
  epoch <span class='op'>=</span> <span class='st'>"5 sec"</span>,
  <span class='va'>dynamic_range</span>,
  noise_level <span class='op'>=</span> <span class='fl'>0.03</span>,
  k <span class='op'>=</span> <span class='fl'>0.05</span>,
  spar <span class='op'>=</span> <span class='fl'>0.6</span>,
  filter_type <span class='op'>=</span> <span class='st'>"butter"</span>,
  cutoffs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.2</span>, <span class='fl'>5</span><span class='op'>)</span>,
  axes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span>,
  use_extrapolation <span class='op'>=</span> <span class='cn'>TRUE</span>,
  use_filtering <span class='op'>=</span> <span class='cn'>TRUE</span>,
  combination <span class='op'>=</span> <span class='st'>"sum"</span>,
  allow_truncation <span class='op'>=</span> <span class='cn'>TRUE</span>,
  output_mims_per_axis <span class='op'>=</span> <span class='cn'>FALSE</span>,
  output_orientation_estimation <span class='op'>=</span> <span class='cn'>FALSE</span>,
  epoch_for_orientation_estimation <span class='op'>=</span> <span class='cn'>NULL</span>,
  before_df <span class='op'>=</span> <span class='cn'>NULL</span>,
  after_df <span class='op'>=</span> <span class='cn'>NULL</span>,
  use_gui_progress <span class='op'>=</span> <span class='cn'>FALSE</span>,
  st <span class='op'>=</span> <span class='cn'>NULL</span>,
  use_snapshot_to_check <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df</th>
      <td><p>dataframe. Input multi-channel accelerometer signal.</p></td>
    </tr>
    <tr>
      <th>epoch</th>
      <td><p>string. Any format that is acceptable by argument <code>breaks</code>
in method <code><a href='https://rdrr.io/r/base/cut.POSIXt.html'>cut.POSIXt</a></code>.For example, "1 sec", "1 min", "5
sec", "10 min". Default is "5 sec".</p></td>
    </tr>
    <tr>
      <th>dynamic_range</th>
      <td><p>numerical vector. The dynamic ranges of the input
signal. Should be a 2-element numerical vector. <code><a href='https://rdrr.io/r/base/c.html'>c(low, high)</a></code>, where
<code>low</code> is the negative max value the device can reach and <code>high</code>
is the positive max value the device can reach.</p></td>
    </tr>
    <tr>
      <th>noise_level</th>
      <td><p>number. The tolerable noise level in \(g\) unit, should
be between 0 and 1. Default is 0.03, which applies to most devices.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>number. Duration of neighborhood to be used in local spline
regression for each side, in seconds. Default is 0.05, as optimized by
MIMS-unit algorithm.</p></td>
    </tr>
    <tr>
      <th>spar</th>
      <td><p>number. Between 0 and 1, to control how smooth we want to fit
local spline regression, 0 is linear and 1 matches all local points.
Default is 0.6, as optimized by MIMS-unit algorithm.</p></td>
    </tr>
    <tr>
      <th>filter_type</th>
      <td><p>string. The type of filter to be applied. Could be
'butter' for butterworth bandpass filter, 'ellip' for elliptic bandpass
filter or 'bessel' for bessel lowpass filter + average removal highpass
filter. Default is "butter".</p></td>
    </tr>
    <tr>
      <th>cutoffs</th>
      <td><p>numerical vector. Cut off frequencies to be used in filtering.
If <code>filter_type</code> is "bessel", the cut off frequency for lowpass filter
would be multiplied by 2 when being used. Default is 0.2Hz and 5Hz.</p></td>
    </tr>
    <tr>
      <th>axes</th>
      <td><p>numerical vector. Indices of columns that specifies the axis
values of the input signal. Default is <code><a href='https://rdrr.io/r/base/c.html'>c(2,3,4)</a></code>.</p></td>
    </tr>
    <tr>
      <th>use_extrapolation</th>
      <td><p>logical. If it is TRUE, the function will apply
extrapolation algorithm to the input signal, otherwise it will skip
extrapolation but only linearly interpolate the signal to 100Hz. Default is
TRUE.</p></td>
    </tr>
    <tr>
      <th>use_filtering</th>
      <td><p>logical. If it is TRUE, the function will apply bandpass
filtering to the input signal, otherwise it will skip the filtering.
Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>combination</th>
      <td><p>string. Method to combine MIMS-unit values for each axis.
Could be "sum" for <code><a href='sum_up.html'>sum_up</a></code> or "vm" for
<code><a href='vector_magnitude.html'>vector_magnitude</a></code>.</p></td>
    </tr>
    <tr>
      <th>allow_truncation</th>
      <td><p>logical. If it is TRUE, the algorithm will truncate
very small MIMS-unit values to zero. Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>output_mims_per_axis</th>
      <td><p>logical. If it is TRUE, the output MIMS-unit
dataframe will have MIMS-unit values for each axis from the third column.
Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>output_orientation_estimation</th>
      <td><p>logical. If it is TRUE, the function
will also estimate sensor orientations over each epoch. And the output will
be a list, with the first element being the MIMS-unit dataframe, and the
second element being the sensor orientation dataframe. Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>epoch_for_orientation_estimation</th>
      <td><p>string. string. Any format that is
acceptable by argument <code>breaks</code> in method
<code><a href='https://rdrr.io/r/base/cut.POSIXt.html'>cut.POSIXt</a></code>.For example, "1 sec", "1 min", "5 sec", "10
min". Default is "5 sec". It is independent from <code>epoch</code> for
MIMS-unit.</p></td>
    </tr>
    <tr>
      <th>before_df</th>
      <td><p>dataframe. The multi-channel accelerometer signal comes
before the input signal to be prepended to the input signal during
computation. This is used to eliminate the edge effect during extrapolation
and filtering. If it is <code>NULL</code>, algorithm will run directly on the
input signal. Default is NULL.</p></td>
    </tr>
    <tr>
      <th>after_df</th>
      <td><p>dataframe. The multi-channel accelerometer signal comes after
the input signal to be append to the input signal. This is used to
eliminate the edge effect during extrapolation and filtering. If it is
<code>NULL</code>, algorithm will run directly on the input signal. Default is
NULL.</p></td>
    </tr>
    <tr>
      <th>use_gui_progress</th>
      <td><p>logical. If it is TRUE, show GUI progress bar on
windows platform. Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>st</th>
      <td><p>character or POSIXct timestamp. An optional start time you can set to
force the epochs generated by referencing this start time. If it is NULL, the
function will use the first timestamp in the timestamp column as start time to
generate epochs. This is useful when you are processing a stream of data and
want to use a common start time for segmenting data. Default is NULL.</p></td>
    </tr>
    <tr>
      <th>use_snapshot_to_check</th>
      <td><p>logical. If TRUE, the function will use the first
100 rows or 10<!-- % (whichever is smaller) to check timestamp duplications. Otherwise, -->
the algorithm will use all data to check timestamp duplications. Default is FALSE.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>dataframe or list. If <code>output_orientation_estimation</code> is TRUE,
  the output will be a list, otherwise the output will be the MIMS-unit
  dataframe.</p>
<p>The first element will be the MIMS-unit dataframe, in which the first
  column is the start time of each epoch in POSIXct format, and the second
  column is the MIMS-unit value for the input signal, and the third column
  and on are the MIMS-unit values for each axis of the input signal if
  <code>output_mims_per_axis</code> is TRUE.</p>
<p>The second element will be the orientation dataframe, in which the first
  column is the start time of each epoch in POSIXct format, and the second to
  fourth column is the estimated orientations for the input signal.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>This function allows you to run customized algorithm for MIMSunit and
  sensor orientations.</p>
<p><code>before_df</code> and <code>after_df</code> are often set when the accelerometer
  data are divided into files of smaller chunk.</p>
    <h2 class="hasAnchor" id="how-is-it-used-in-mims-unit-algorithm-"><a class="anchor" href="#how-is-it-used-in-mims-unit-algorithm-"></a>How is it used in MIMS-unit algorithm?</h2>

    <p>This is the low-level entry
  of MIMS-unit and orientation estimation algorithm. <code><a href='mims_unit.html'>mims_unit</a></code>
  calls this function internally.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Top level API functions: 
<code><a href='mims_unit.html'>mims_unit</a>()</code>,
<code><a href='sensor_orientations.html'>sensor_orientations</a>()</code>,
<code><a href='shiny_app.html'>shiny_app</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>  <span class='co'># Use sample data for testing</span>
  <span class='va'>df</span> <span class='op'>=</span> <span class='va'>sample_raw_accel_data</span>

  <span class='co'># compute mims unit values with custom parameter</span>
  <span class='va'>output</span> <span class='op'>=</span> <span class='fu'>custom_mims_unit</span><span class='op'>(</span><span class='va'>df</span>, epoch <span class='op'>=</span> <span class='st'>'1 sec'</span>, dynamic_range<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>8</span>, <span class='fl'>8</span><span class='op'>)</span>, spar<span class='op'>=</span><span class='fl'>0.7</span><span class='op'>)</span>
</div><div class='output co'>#&gt; ================================================================================</div><div class='input'>  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>output</span><span class='op'>)</span>
</div><div class='output co'>#&gt;         HEADER_TIME_STAMP MIMS_UNIT
#&gt; 1 2016-01-15 11:00:00.013  1.071916
#&gt; 2 2016-01-15 11:00:01.003  1.079748
#&gt; 3 2016-01-15 11:00:02.003  1.001164
#&gt; 4 2016-01-15 11:00:03.003  1.023815
#&gt; 5 2016-01-15 11:00:04.003  1.016161
#&gt; 6 2016-01-15 11:00:05.003  0.813439</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://qutang.dev'><img class='img-circle p-3' src="https://d33wubrfki0l68.cloudfront.net/8af2089476f179254b3bc9628e13f7d143acab42/8309e/images/avatar.jpg" height="40" /><span> Qu Tang</span></a>, <a href='https://bouve.northeastern.edu/directory/dinesh-john/'><img class='img-circle p-3' src="https://banner2.kisspng.com/20180410/bbw/kisspng-avatar-user-medicine-surgery-patient-avatar-5acc9f7a7cb983.0104600115233596105109.jpg" height="40" /><span> Dinesh John</span></a>, <a href='http://www.ccs.neu.edu/home/intille/'><img class='img-circle p-3' src="http://www.ccs.neu.edu/home/intille/intille-headshot-sm2.jpg" height="40" /><span> Stephen Intille</span></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


